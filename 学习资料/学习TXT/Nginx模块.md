# Nginx模块
## 概念
- 高内聚，低耦合
## 模块五大类
- 核心模块：进程管理，权限控制，错误日志，配置解析；事件驱动，正则表达式解析
- 标准HTTP模块：支持Nginx服务器的标准HTTP功能
- 可选HTTP模块：主要用于扩展标准的HTTP功能，处理一些特殊的HTTP请求
- 邮件服务模块：支持Nginx邮件服务
- 第三方模块：扩展Nginx服务器应用
## Nginx服务器的Web请求处理机制
- 并行处理请求三种方式：多进程方式、多线程方式、异步方式
### 多进程方式
- 服务器每当接收到一个客户端时，就由服务器主进程生成一个子进程出来和该客户端建立连接进行交互，直至连接断开，子进程就结束了。
- 优点：设计和实现简单；子进程相互独立，彼此不干扰，保证提供服务的稳定性。
- 缺点：生成一个子进程需要进行内存复制等操作，在资源和时间上产生一定的额外开销，大量并发请求，会对系统资源造成压力，导致系统性能下降。
### 多线程方式
- 服务器每当接收到一个客户端时，会由服务器主进程派生一个线程和客户端进行交互。
- 优点：开销小，减轻web服务器对系统资源的要求
- 缺点：多线程位于同一个进程内，访问共同的内存空间，彼此间相互影响；开发者管理内存，存在风险。
### 异步方式
- 所有发送方的请求形成一个队列，接收处理完后通知发送方。
## epoll库
- epoll库通过相关调用通知内核创建一个有N个描述符的事件列表，给这些描述符设置所挂糊的事件，并把它添加到内核的事件列表中去。完成设置后，epoll就开始等待内核通知事件发生了。某一事件发生后，内核将发生事件的描述符列表上报给epoll库。得到事件列表的epoll库，就可以进行处理事件了。
## 进程交互
### Master-Worker交互
- Nginx服务器启动后，主进程根据配置文件决定生成的工作进程的数量，建立一张全局的工作进程表用于存放当前未退出的所有工作进程。生成进程后，将生成的工作进程加入到工作进程表中，并建立一个单向管道并将其传递给该工作进程。主进程与外界通过信号机制进行通信，当接收到需要处理的信号时，工作进程从管道读取并解析指令，然后采取相应的措施。完成Master-Worker交互。
### Worker-Worker交互
- 为了达到工作进程间交互，主进程生成工作进程后，在工作进程表中进行遍历，将该新进程的ID以及对该进程建立的管道句柄传给工作进程表中的其他进程，为工作进程之间的交互做准备。